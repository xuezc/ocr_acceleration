# ocr_acceleration

## 一 Tensorrt中不定长输入的处理方法

&emsp;&emsp;在tensorrt中，针对不同的超参数有一写算法层面的优化，比如会根据卷积核的大小、输入大小等超参数确定使用哪种算法进行卷积运算。因此，输入会设置为固定大小。而且，输入输出大小固定，可以做memory优化。
关于任意尺寸图片的输入，列举了一个mnist的例子，在代码中已有详细的注释。在处理过程中，共建立了两个引擎，具体的处理步骤如下：

&emsp;&emsp;1.使用一个支持任意尺寸输出的网络，创建一个预处理引擎；

&emsp;&emsp;2.将动态尺寸的图片输入网络，将图片reshape为(1, 1, 28, 28)，便于后续的处理；

&emsp;&emsp;3.通过解析ONNX模型建立一个引擎用于推理；

&emsp;&emsp;4.然后即可将已经处理为固定尺寸的输入，输入到第二个引擎中用于正常的推理。

## 二 在ocr识别中使用tensorrt

&emsp;&emsp;在识别部分，因为模型的输入为不定长，导致了不能直接使用tensorrt来进行加速。因此，为了能使用tensorrt，需要将识别的输入设置为固定值。所以，可以经由以下步骤来实现

&emsp;&emsp;1.先创建一个引擎，将识别的输入根据长度分为几类，然后将不定长的输入处理为固定的几种长度；

&emsp;&emsp;2.建立第二个引擎用于推理，因为经过第一个引擎处理过的输入为几种固定长度。因此第二个引擎需要匹配第一个引擎的输出，设置为多种输入的多个引擎，由不同的引擎去处理不同的长度的输入；

&emsp;&emsp;3.对第二个引擎处理后的输出进行处理，消除在预处理时的影响。
